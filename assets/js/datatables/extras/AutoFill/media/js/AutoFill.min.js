
var AutoFill;(function(a){AutoFill=function(b,c){if(!this.CLASS||this.CLASS!="AutoFill"){alert("Warning: AutoFill must be initialised with the keyword 'new'");return}if(!a.fn.dataTableExt.fnVersionCheck("1.7.0")){alert("Warning: AutoFill requires DataTables 1.7 or greater - www.datatables.net/download");return}this.s={filler:{height:0,width:0},border:{width:2},drag:{startX:-1,startY:-1,startTd:null,endTd:null,dragging:false},screen:{interval:null,y:0,height:0,scrollTop:0},scroller:{top:0,bottom:0},columns:[]};this.dom={table:null,filler:null,borderTop:null,borderRight:null,borderBottom:null,borderLeft:null,currentTarget:null};this.fnSettings=function(){return this.s};this._fnInit(b,c);return this};AutoFill.prototype={_fnInit:function(e,j){var h=this,g,b;this.s.dt=e.fnSettings();this.dom.table=this.s.dt.nTable;for(g=0,b=this.s.dt.aoColumns.length;g<b;g++){this._fnAddColumn(g)}if(typeof j!="undefined"&&typeof j.aoColumnDefs!="undefined"){this._fnColumnDefs(j.aoColumnDefs)}if(typeof j!="undefined"&&typeof j.aoColumns!="undefined"){this._fnColumnsAll(j.aoColumns)}var f=document.createElement("div");f.className="AutoFill_filler";document.body.appendChild(f);this.dom.filler=f;f.style.display="block";this.s.filler.height=a(f).height();this.s.filler.width=a(f).width();f.style.display="none";var d;var c=document.body;if(h.s.dt.oScroll.sY!==""){h.s.dt.nTable.parentNode.style.position="relative";c=h.s.dt.nTable.parentNode}d=document.createElement("div");d.className="AutoFill_border";c.appendChild(d);this.dom.borderTop=d;d=document.createElement("div");d.className="AutoFill_border";c.appendChild(d);this.dom.borderRight=d;d=document.createElement("div");d.className="AutoFill_border";c.appendChild(d);this.dom.borderBottom=d;d=document.createElement("div");d.className="AutoFill_border";c.appendChild(d);this.dom.borderLeft=d;a(f).mousedown(function(k){this.onselectstart=function(){return false};h._fnFillerDragStart.call(h,k);return false});a("tbody>tr>td",this.dom.table).live("mouseover mouseout",function(k){h._fnFillerDisplay.call(h,k)})},_fnColumnDefs:function(e){var f,d,c,b,l,h,g;for(f=e.length-1;f>=0;f--){g=e[f].aTargets;for(d=0,l=g.length;d<l;d++){if(typeof g[d]=="number"&&g[d]>=0){this._fnColumnOptions(g[d],e[f])}else{if(typeof g[d]=="number"&&g[d]<0){this._fnColumnOptions(this.s.dt.aoColumns.length+g[d],e[f])}else{if(typeof g[d]=="string"){for(c=0,h=this.s.dt.aoColumns.length;c<h;c++){if(g[d]=="_all"||this.s.dt.aoColumns[c].nTh.className.indexOf(g[d])!=-1){this._fnColumnOptions(c,e[f])}}}}}}}},_fnColumnsAll:function(c){for(var d=0,b=this.s.dt.aoColumns.length;d<b;d++){this._fnColumnOptions(d,c[d])}},_fnAddColumn:function(b){this.s.columns[b]={enable:true,read:this._fnReadCell,write:this._fnWriteCell,step:this._fnStep,complete:null}},_fnColumnOptions:function(b,c){if(typeof c.bEnable!="undefined"){this.s.columns[b].enable=c.bEnable}if(typeof c.fnRead!="undefined"){this.s.columns[b].read=c.fnRead}if(typeof c.fnWrite!="undefined"){this.s.columns[b].write=c.fnWrite}if(typeof c.fnStep!="undefined"){this.s.columns[b].step=c.fnStep}if(typeof c.fnCallback!="undefined"){this.s.columns[b].complete=c.fnCallback}},_fnTargetCoords:function(b){var c=a(b).parents("tr")[0];return{x:a("td",c).index(b),y:a("tr",c.parentNode).index(c)}},_fnUpdateBorder:function(k,l){var h=this.s.border.width,j=a(k).offset(),n=a(l).offset(),e=j.left-h,c=n.left+a(l).outerWidth(),o=j.top-h,m=n.top+a(l).outerHeight(),d=n.left+a(l).outerWidth()-j.left+(2*h),q=n.top+a(l).outerHeight()-j.top+(2*h),p;if(this.s.dt.oScroll.sY!==""){var b=a(this.s.dt.nTable.parentNode).offset(),f=a(this.s.dt.nTable.parentNode).scrollTop(),g=a(this.s.dt.nTable.parentNode).scrollLeft();e-=b.left-g;c-=b.left-g;o-=b.top-f;m-=b.top-f}p=this.dom.borderTop.style;p.top=o+"px";p.left=e+"px";p.height=this.s.border.width+"px";p.width=d+"px";p=this.dom.borderBottom.style;p.top=m+"px";p.left=e+"px";p.height=this.s.border.width+"px";p.width=d+"px";p=this.dom.borderLeft.style;p.top=o+"px";p.left=e+"px";p.height=q+"px";p.width=this.s.border.width+"px";p=this.dom.borderRight.style;p.top=o+"px";p.left=c+"px";p.height=q+"px";p.width=this.s.border.width+"px"},_fnFillerDragStart:function(d){var b=this;var f=this.dom.currentTarget;this.s.drag.dragging=true;b.dom.borderTop.style.display="block";b.dom.borderRight.style.display="block";b.dom.borderBottom.style.display="block";b.dom.borderLeft.style.display="block";var c=this._fnTargetCoords(f);this.s.drag.startX=c.x;this.s.drag.startY=c.y;this.s.drag.startTd=f;this.s.drag.endTd=f;this._fnUpdateBorder(f,f);a(document).bind("mousemove.AutoFill",function(g){b._fnFillerDragMove.call(b,g)});a(document).bind("mouseup.AutoFill",function(g){b._fnFillerFinish.call(b,g)});this.s.screen.y=d.pageY;this.s.screen.height=a(window).height();this.s.screen.scrollTop=a(document).scrollTop();if(this.s.dt.oScroll.sY!==""){this.s.scroller.top=a(this.s.dt.nTable.parentNode).offset().top;this.s.scroller.bottom=this.s.scroller.top+a(this.s.dt.nTable.parentNode).height()}this.s.screen.interval=setInterval(function(){var e=a(document).scrollTop();var g=e-b.s.screen.scrollTop;b.s.screen.y+=g;if(b.s.screen.height-b.s.screen.y+e<50){a("html, body").animate({scrollTop:e+50},240,"linear")}else{if(b.s.screen.y-e<50){a("html, body").animate({scrollTop:e-50},240,"linear")}}if(b.s.dt.oScroll.sY!==""){if(b.s.screen.y>b.s.scroller.bottom-50){a(b.s.dt.nTable.parentNode).animate({scrollTop:a(b.s.dt.nTable.parentNode).scrollTop()+50},240,"linear")}else{if(b.s.screen.y<b.s.scroller.top+50){a(b.s.dt.nTable.parentNode).animate({scrollTop:a(b.s.dt.nTable.parentNode).scrollTop()-50},240,"linear")}}}},250)},_fnFillerDragMove:function(d){if(d.target&&d.target.nodeName.toUpperCase()=="TD"&&d.target!=this.s.drag.endTd){var c=this._fnTargetCoords(d.target);if(c.x!=this.s.drag.startX){d.target=a("tbody>tr:eq("+c.y+")>td:eq("+this.s.drag.startX+")",this.dom.table)[0];c=this._fnTargetCoords(d.target)}if(c.x==this.s.drag.startX){var b=this.s.drag;b.endTd=d.target;if(c.y>=this.s.drag.startY){this._fnUpdateBorder(b.startTd,b.endTd)}else{this._fnUpdateBorder(b.endTd,b.startTd)}this._fnFillerPosition(d.target)}}this.s.screen.y=d.pageY;this.s.screen.scrollTop=a(document).scrollTop();if(this.s.dt.oScroll.sY!==""){this.s.scroller.scrollTop=a(this.s.dt.nTable.parentNode).scrollTop();this.s.scroller.top=a(this.s.dt.nTable.parentNode).offset().top;this.s.scroller.bottom=this.s.scroller.top+a(this.s.dt.nTable.parentNode).height()}},_fnFillerFinish:function(n){var l=this;a(document).unbind("mousemove.AutoFill");a(document).unbind("mouseup.AutoFill");this.dom.borderTop.style.display="none";this.dom.borderRight.style.display="none";this.dom.borderBottom.style.display="none";this.dom.borderLeft.style.display="none";this.s.drag.dragging=false;clearInterval(this.s.screen.interval);var m=this._fnTargetCoords(this.s.drag.startTd);var p=this._fnTargetCoords(this.s.drag.endTd);var c=[];var h;if(m.y<=p.y){h=true;for(i=m.y;i<=p.y;i++){c.push(a("tbody>tr:eq("+i+")>td:eq("+m.x+")",this.dom.table)[0])}}else{h=false;for(i=m.y;i>=p.y;i--){c.push(a("tbody>tr:eq("+i+")>td:eq("+m.x+")",this.dom.table)[0])}}var j=m.x;var o=false;var k=[];var b=this.s.columns[j].read.call(this,this.s.drag.startTd);var g=this._fnPrep(b);for(i=0,iLen=c.length;i<iLen;i++){if(i==iLen-1){o=true}var f=this.s.columns[j].read.call(this,c[i]);var d=this.s.columns[j].step.call(this,c[i],g,i,h,"SPRYMEDIA_AUTOFILL_STEPPER");this.s.columns[j].write.call(this,c[i],d,o);k.push({td:c[i],newValue:d,oldValue:f})}if(this.s.columns[j].complete!==null){this.s.columns[j].complete.call(this,k)}},_fnPrep:function(d){var e=d.match(/[\d\.]+/g);if(!e||e.length===0){return{iStart:0,sStr:d,sPostFix:""}}var b=e[e.length-1];var f=parseInt(b,10);var g=new RegExp("^(.*)"+b+"(.*?)$");var c=b.match(/\./)?"."+b.split(".")[1]:"";return{iStart:f,sStr:d.replace(g,"$1SPRYMEDIA_AUTOFILL_STEPPER$2"),sPostFix:c}},_fnStep:function(b,e,g,c,f){var d=c?(e.iStart+g):(e.iStart-g);if(isNaN(d)){d=""}return e.sStr.replace(f,d+e.sPostFix)},_fnReadCell:function(b){var c=a("input",b);if(c.length>0){return a(c).val()}c=a("select",b);if(c.length>0){return a(c).val()}return b.innerHTML},_fnWriteCell:function(c,b,d){var f=a("input",c);if(f.length>0){a(f).val(b);return}f=a("select",c);if(f.length>0){a(f).val(b);return}var e=this.s.dt.oInstance.fnGetPosition(c);this.s.dt.oInstance.fnUpdate(b,e[0],e[2],d)},_fnFillerDisplay:function(f){if(this.s.drag.dragging){return}var c=(f.target.nodeName.toLowerCase()=="td")?f.target:a(f.target).parents("td")[0];var b=this._fnTargetCoords(c).x;if(!this.s.columns[b].enable){return}var d=this.dom.filler;if(f.type=="mouseover"){this.dom.currentTarget=c;this._fnFillerPosition(c);d.style.display="block"}else{if(!f.relatedTarget||!f.relatedTarget.className.match(/AutoFill/)){d.style.display="none"}}},_fnFillerPosition:function(b){var d=a(b).offset();var c=this.dom.filler;c.style.top=(d.top-(this.s.filler.height/2)-1+a(b).outerHeight())+"px";c.style.left=(d.left-(this.s.filler.width/2)-1+a(b).outerWidth())+"px"}};AutoFill.prototype.CLASS="AutoFill";AutoFill.VERSION="1.1.2";AutoFill.prototype.VERSION=AutoFill.VERSION})(jQuery);